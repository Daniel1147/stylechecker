#!/bin/sh

filename=$1
suffix=${filename##*.}
echo "suffix" $suffix

if [ $suffix = "c" ]
then
    compiler="gcc"
elif [ $suffix = "cc" ]
then
    compiler="g++"
else
    echo "unknown suffix" $suffix
    exit
fi
     
preprocessed=`mktemp`.c
$compiler -E "$1" > $preprocessed
$compiler -g $preprocessed

nmlist=`mktemp`
global=`nm -l a.out | grep ":" | grep "[0-8] [^T]" | tee $nmlist | wc -l`
echo "global variables found:" $global
cat $nmlist
echo "============================"
cc1=`grep -w -E "(if)|(case)|(while)|(for)" -o $preprocessed | wc -l`
echo "if case while for found:" $cc1
grep -w -E "(if)|(case)|(while)|(for)" $preprocessed
echo "============================"
cc2=`grep -E "(\?)|(&&)|(\|\|)" -o $preprocessed | wc -l`
echo "? && || found:" $cc2
grep -E "(\?)|(&&)|(\|\|)" $preprocessed
echo "============================"
echo "estimated cyclomatic complexity: " $(( $cc1 + $cc2 ))
echo "============================"
goto=`grep -w -E "goto" -o $preprocessed | wc -l`
echo "goto found:" $goto
grep -w -E "goto" $preprocessed

